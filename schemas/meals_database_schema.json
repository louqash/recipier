{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Meals Database Schema",
  "description": "Database of meal recipes that can be referenced in meal plans",
  "type": "object",
  "required": ["meals", "ingredient_details"],
  "properties": {
    "ingredient_details": {
      "type": "object",
      "description": "Ingredient details for calorie calculation and package rounding",
      "additionalProperties": {
        "type": "object",
        "required": ["calories_per_100g"],
        "properties": {
          "calories_per_100g": {
            "type": "number",
            "description": "Calories per 100g/ml of this ingredient",
            "example": 90
          },
          "unit_size": {
            "type": ["number", "null"],
            "description": "Rounding increment (e.g., 40g for sachet, 60g for individual tortilla). If set, ingredient will be rounded to multiples of this size.",
            "example": 40
          },
          "adjustable": {
            "type": "boolean",
            "description": "Whether this ingredient can be modified for calorie compensation. Defaults to true, automatically false if unit_size is set.",
            "default": true
          }
        }
      }
    },
    "meals": {
      "type": "array",
      "description": "Library of available meal recipes",
      "items": {
        "type": "object",
        "required": ["meal_id", "name", "base_servings", "ingredients"],
        "properties": {
          "meal_id": {
            "type": "string",
            "description": "Unique identifier for this meal recipe",
            "example": "spaghetti_carbonara"
          },
          "name": {
            "type": "string",
            "description": "Name of the dish",
            "example": "Spaghetti Carbonara"
          },
          "base_servings": {
            "type": "object",
            "description": "Base serving sizes per diet profile (e.g., 'high_calorie': 1.67, 'low_calorie': 1.0). Users are mapped to diet profiles in config.",
            "additionalProperties": {
              "type": "number",
              "description": "Multiplier for this diet profile (e.g., 1.0 for standard, 1.67 for high calorie)",
              "example": 1.67
            },
            "examples": [
              {
                "high_calorie": 1.67,
                "low_calorie": 1.0
              }
            ]
          },
          "ingredients": {
            "type": "array",
            "description": "Ingredients per BASE serving (will be multiplied by servings in meal plan)",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["name", "quantity", "unit", "category"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Ingredient name",
                  "example": "spaghetti"
                },
                "quantity": {
                  "type": "number",
                  "description": "Amount per BASE serving",
                  "example": 100
                },
                "unit": {
                  "type": "string",
                  "description": "Unit of measurement",
                  "example": "g"
                },
                "category": {
                  "type": "string",
                  "enum": ["produce", "meat", "dairy", "pantry", "frozen", "bakery", "beverages", "other"],
                  "description": "Shopping category"
                },
                "notes": {
                  "type": "string",
                  "description": "Optional notes about the ingredient",
                  "example": "fresh, not dried"
                }
              }
            }
          },
          "prep_tasks": {
            "type": "array",
            "description": "Preparation tasks for this recipe",
            "items": {
              "type": "object",
              "required": ["description", "days_before"],
              "properties": {
                "description": {
                  "type": "string",
                  "example": "Marinate chicken overnight"
                },
                "days_before": {
                  "type": "integer",
                  "minimum": 1,
                  "example": 1
                }
              }
            }
          },
          "notes": {
            "type": "string",
            "description": "Recipe notes",
            "example": "Jane's favorite!"
          },
          "steps": {
            "type": "array",
            "description": "Cooking steps/instructions for this recipe",
            "items": {
              "type": "string",
              "description": "Individual cooking step",
              "example": "Cook pasta according to package instructions"
            }
          },
          "suggested_seasonings": {
            "type": "string",
            "description": "Suggested seasonings and spices for this recipe",
            "example": "Salt, pepper, oregano"
          }
        }
      }
    }
  }
}
